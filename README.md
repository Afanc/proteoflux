# ProteoFlux

ProteoFlux is an open-source Python framework for transparent, reproducible downstream analysis of quantitative proteomics data.  
It operates on outputs generated by upstream peptide and protein identification and quantification tools and provides a unified workflow for protein-centric proteomics, peptide-centric analyses, and phosphoproteomics with optional protein-level covariate adjustment.

ProteoFlux emphasizes:

- Explicit data semantics
- Transparent preprocessing
- Reproducible statistical modeling
- Standardized, portable outputs

---

## Overview

ProteoFlux takes a single YAML configuration file and produces:

- Harmonized and preprocessed quantification data
- Differential expression results using a limma-based empirical Bayes framework
- PCA, MDS, and hierarchical clustering
- A structured multi-page PDF report
- Portable `.h5ad` files compatible with **ProteoViewer**
- Summary tables in Excel or CSV format

Supported modalities:

- Protein-centric proteomics
- Peptide-centric workflows
- Phosphoproteomics (with optional protein-level covariate adjustment)

Supported input types:

- Long-format quantitative tables
- Wide-format tables
- Outputs from tools such as Spectronaut, FragPipe, and DIA-NN (including Parquet-based outputs)

---

## Installation

ProteoFlux requires Python 3.9 or higher.

### Install from PyPI

```bash
pip install proteoflux
```

### Install from source

```bash
git clone https://github.com/YOUR-ORG/proteoflux.git
cd proteoflux
pip install -e .
```

---

## Command-line usage

Create a configuration template:

```bash
proteoflux init my_config.yaml
```

Vendor-specific templates (e.g., Spectronaut, FragPipe, DIA-NN) can also be generated via:

```bash
proteoflux init --template spectronaut my_config.yaml
```

Run the full pipeline:

```bash
proteoflux run --config my_config.yaml
```

---

## Pipeline steps

1. Harmonization of vendor-specific input tables
2. Filtering and data curation
3. Quantification and roll-up (sum, directLFQ, etc.)
4. Log transformation and normalization
5. Imputation (default: LC-ConMed)
6. Differential expression modeling (limma + empirical Bayes)
7. Clustering and dimensionality reduction (PCA, MDS, hierarchical clustering)
8. Export of results and reports

---

## Output files

| File                       | Description |
|----------------------------|------------|
| `proteoflux_results.h5ad`  | Main AnnData object containing raw, processed, and statistical results |
| `proteoflux_table.xlsx`    | Summary table of log2FC, statistics, annotations, and missingness |
| `proteoflux_report.pdf`    | Multi-page QC and results report |
| `.csv` equivalents         | Generated if Excel export is disabled |

The `.h5ad` output preserves raw, normalized, and imputed matrices, statistical results, residuals, clustering embeddings, and full provenance metadata.

---

## Viewing results

Results can be explored interactively using **ProteoViewer** (see https://github.com/afanc/proteoviewer).

---

## Configuration

All parameters are defined in a single YAML file.

The template includes sections such as:

- `dataset`: input files, annotation, layout
- `preprocessing`: filtering, normalization, imputation
- `analysis`: contrasts, covariates, thresholds
- `exports`: output formats and report configuration

All preprocessing and analysis parameters are stored in the output `.h5ad` metadata to ensure full reproducibility.

---

## Dependencies

Core dependencies are defined in `pyproject.toml` and include:

- numpy
- pandas
- polars
- scanpy
- anndata
- scikit-learn
- directlfq
- inmoose
- matplotlib
- openpyxl
- typer
- pyyaml
- tqdm

---

## License

ProteoFlux is released under the MIT License.

---

## Citation

A formal publication is in preparation.

Until the paper DOI becomes available, please cite the software repository release (Zenodo DOI).
Citation details will be updated upon publication.
